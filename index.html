<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>بطاقات الدول — نسخة أوفلاين تعمل دائمًا (بدون أي API)</title>
  <style>
    :root { color-scheme: dark; }
    *{box-sizing:border-box}
    body{margin:0;background:#0b1220;color:#e5e7eb;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial,"Apple Color Emoji","Segoe UI Emoji"}
    header{position:sticky;top:0;z-index:10;background:#0b1220cc;backdrop-filter:blur(6px);border-bottom:1px solid #1f2937}
    .container{max-width:1200px;margin-inline:auto;padding:14px}
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between}
    input,button{border-radius:12px;border:1px solid #334155;background:#0f172a;color:#e5e7eb;padding:10px 12px}
    button{background:#4f46e5;border-color:#4f46e5;cursor:pointer}
    button:hover{filter:brightness(1.1)}/* شبكة وبطاقة بدون Tailwind */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:14px;padding:14px}
.card{position:relative;border-radius:22px;overflow:hidden;border:1px solid #1f2937;transition:transform .2s ease,box-shadow .2s ease,height .25s ease}
.card[data-expanded="0"]{height:110px}
.card[data-expanded="1"]{height:260px}
.card:hover{transform:scale(1.02);box-shadow:0 18px 40px rgba(0,0,0,.45)}
.pad{position:absolute;inset:0;padding:14px}
.detail{transition:opacity .2s ease, transform .2s ease}
.card[data-expanded="0"] .detail{opacity:0;transform:translateY(8px);pointer-events:none}
.corner{position:absolute;width:110px;height:110px;background:rgba(0,0,0,.25);border-radius:50%}
.corner.tl{top:-60px;right:-60px}
.corner.br{bottom:-60px;left:-60px}

.title{position:absolute;top:12px;right:14px;display:flex;gap:8px;align-items:center}
.flag{width:28px;height:20px;border-radius:4px;outline:1px solid #fff3}
.country{font-weight:700}
.temp{font-size:32px;font-weight:800}

.time{position:absolute;left:14px;bottom:44px}
.time .clock{font-size:40px;font-weight:900}
.info{position:absolute;right:14px;bottom:44px;text-align:right}

/* شريط خبر عاجل */
.news{position:absolute;left:0;right:0;bottom:0;background:rgba(0,0,0,.25);border-top:1px dashed #ffffff33;padding:6px 14px;white-space:nowrap;overflow:hidden}
.news-label{color:#fecaca;font-weight:700;margin-left:8px}
.track{display:inline-block;padding-left:100%;animation:ticker 18s linear infinite}
.dup{display:inline-block}
.news:hover .track{animation-play-state:paused}
@keyframes ticker{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

/* سكيليتون */
.skeleton{background:linear-gradient(90deg,#111827 25%,#1f2937 37%,#111827 63%);background-size:400% 100%;animation:shimmer 1.2s infinite}
@keyframes shimmer{0%{background-position:100% 0}100%{background-position:-100% 0}}

  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="row">
        <div style="display:flex;gap:10px;align-items:center"><div style="font-size:22px">🌍</div><div style="font-weight:800">بطاقات الدول — نسخة أوفلاين</div></div>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="q" placeholder="ابحث: دولة / عملة…" />
          <button id="toggle-online">تشغيل المزايا أونلاين</button>
        </div>
      </div>
    </div>
  </header>  <main class="container">
    <div id="hint" style="color:#cbd5e1;font-size:13px;margin:8px 2px">هذه نسخة تعمل بدون إنترنت خارجي (لضمان الظهور دائمًا). يمكنك تفعيل الجلب من الإنترنت لاحقًا.</div>
    <div id="grid" class="grid"></div>
  </main>  <script>
    // ===== خيارات =====
    let ENABLE_ONLINE = false; // بدّل إلى true بالجهاز عندك أو زر العنوان لتفعيل الجلب الخارجي

    // ===== ألوان =====
    function hashHue(str){ let h=0; for(let i=0;i<str.length;i++){ h=(h*31+str.charCodeAt(i))>>>0; } return h%360; }
    function themeFromCode(code){ const h=hashHue(code||'XX'); return { from:`hsl(${h} 80% 45%)`, to:`hsl(${(h+24)%360} 85% 55%)` }; }
    function gradient(theme, night){ const from = night? '#0f172a':theme.from; const to = night? '#0b1220':theme.to; return `linear-gradient(180deg, ${from} 0%, ${to} 68%, rgba(2,6,23,.95) 120%)`; }

    // ===== بيانات أوفلاين جاهزة (20 بلد) =====
    const OFFLINE = [
      ['DE','ألمانيا','Europe/Berlin',52.52,13.405,'EUR','de','أوروبا'],
      ['SA','السعودية','Asia/Riyadh',24.7136,46.6753,'SAR','sa','آسيا'],
      ['EG','مصر','Africa/Cairo',30.0444,31.2357,'EGP','eg','أفريقيا'],
      ['TR','تركيا','Europe/Istanbul',41.0151,28.9795,'TRY','tr','آسيا'],
      ['AE','الإمارات','Asia/Dubai',25.2048,55.2708,'AED','ae','آسيا'],
      ['QA','قطر','Asia/Qatar',25.2854,51.5310,'QAR','qa','آسيا'],
      ['KW','الكويت','Asia/Kuwait',29.3759,47.9774,'KWD','kw','آسيا'],
      ['US','الولايات المتحدة','America/New_York',40.7128,-74.0060,'USD','us','أمريكا'],
      ['GB','بريطانيا','Europe/London',51.5072,-0.1276,'GBP','gb','أوروبا'],
      ['FR','فرنسا','Europe/Paris',48.8566,2.3522,'EUR','fr','أوروبا'],
      ['IT','إيطاليا','Europe/Rome',41.9028,12.4964,'EUR','it','أوروبا'],
      ['ES','إسبانيا','Europe/Madrid',40.4168,-3.7038,'EUR','es','أوروبا'],
      ['RU','روسيا','Europe/Moscow',55.7558,37.6173,'RUB','ru','أوروبا'],
      ['CN','الصين','Asia/Shanghai',31.2304,121.4737,'CNY','cn','آسيا'],
      ['JP','اليابان','Asia/Tokyo',35.6762,139.6503,'JPY','jp','آسيا'],
      ['KR','كوريا الجنوبية','Asia/Seoul',37.5665,126.9780,'KRW','kr','آسيا'],
      ['IN','الهند','Asia/Kolkata',28.6139,77.2090,'INR','in','آسيا'],
      ['BR','البرازيل','America/Sao_Paulo',-23.5505,-46.6333,'BRL','br','أمريكا'],
      ['CA','كندا','America/Toronto',43.651070,-79.347015,'CAD','ca','أمريكا'],
      ['AU','أستراليا','Australia/Sydney',-33.8688,151.2093,'AUD','au','أوقيانوسيا']
    ].map(([code,name,tz,lat,lon,ccy,flag,region])=>({
      code,name,tz,lat,lon,currency:{code:ccy},flag,region,theme:themeFromCode(code)
    }));

    let COUNTRIES = [...OFFLINE];

    // ===== طقس (محلي: رموز فقط) =====
    function iconSVGByWeather(code, is_day){
      const sun = `<circle cx='50' cy='50' r='24' fill='#facc15'/>`;
      const moon = `<path d='M64 50a22 22 0 1 1-28-28a24 24 0 1 0 28 28z' fill='#e5e7eb'/>`;
      const cloud = `<ellipse cx='52' cy='60' rx='26' ry='16' fill='white'/><ellipse cx='36' cy='62' rx='18' ry='12' fill='white'/>`;
      const sky = is_day ? sun : moon;
      if(code===0) return `<svg viewBox='0 0 100 100'>${sky}</svg>`; return `<svg viewBox='0 0 100 100'>${sky}${cloud}</svg>`;
    }

    // ===== بطاقة =====
    function createCard(c){
      const card = document.createElement('article');
      card.className = 'card';
      card.dataset.expanded = '0';
      card.style.background = gradient(c.theme,false);
      card.dataset.countryName = `${c.name} ${c.currency.code}`;

      const pad = document.createElement('div'); pad.className='pad';

      const title = document.createElement('div'); title.className='title';
      title.innerHTML = `<div class="temp" data-temp>—°</div>
        <div style="display:flex;flex-direction:column;align-items:end">
          <div style="display:flex;gap:6px;align-items:center">
            <img class="flag" src="https://flagcdn.com/w40/${c.flag}.png" alt=""/>
            <span class="country">${c.name}</span>
          </div>
          <div style="opacity:.75;font-size:12px">${c.tz}</div>
        </div>`;

      const icon = document.createElement('div'); icon.className='detail';
      icon.style.position='absolute'; icon.style.left='14px'; icon.style.top='12px';
      icon.style.width='68px'; icon.style.height='68px'; icon.innerHTML = iconSVGByWeather(1,true);

      const time = document.createElement('div'); time.className='time detail';
      time.innerHTML = `<div style="opacity:.9;font-size:13px" data-date>—</div><div class="clock" data-time>--:--</div>`;

      const info = document.createElement('div'); info.className='info detail';
      info.innerHTML = `<div style="opacity:.9;font-size:13px" data-sunset>غروب الشمس: —</div><div style="opacity:.9;font-size:12px" data-fx>1 USD = — ${c.currency.code}</div>`;

      const news = document.createElement('div'); news.className='news detail';
      news.innerHTML = `<span class="news-label">خبر عاجل:</span><span class="track" data-news>  — نسخة أوفلاين: أدخل الإعدادات لتفعيل الأخبار المباشرة —   </span><span class="dup" data-news-dup>  — نسخة أوفلاين: أدخل الإعدادات لتفعيل الأخبار المباشرة —   </span>`;

      const c1=document.createElement('div'); c1.className='corner tl';
      const c2=document.createElement('div'); c2.className='corner br';

      pad.appendChild(title); pad.appendChild(icon); pad.appendChild(time); pad.appendChild(info); pad.appendChild(news);
      card.appendChild(pad); card.appendChild(c1); card.appendChild(c2);

      // toggle
      card.addEventListener('click',()=>{
        const ex = card.dataset.expanded==='1';
        card.style.transform='scale(1.03)'; setTimeout(()=>card.style.transform='',160);
        card.dataset.expanded = ex? '0':'1';
        if(!ex && ENABLE_ONLINE){ loadOnlineFor(c, card); }
      });

      // clock
      function tick(){
        const now = new Date();
        try{
          const t = new Intl.DateTimeFormat('ar-EG',{timeZone:c.tz,hour12:false,hour:'2-digit',minute:'2-digit'}).format(now);
          const d = new Intl.DateTimeFormat('ar-EG',{timeZone:c.tz,weekday:'long',day:'numeric',month:'long'}).format(now);
          card.querySelector('[data-time]').textContent=t;
          card.querySelector('[data-date]').textContent=d;
        }catch{ card.querySelector('[data-time]').textContent='—'; }
      }
      tick(); setInterval(tick,1000);

      // placeholders
      card.querySelector('[data-temp]').textContent='—°';
      card.querySelector('[data-sunset]').textContent='غروب الشمس: —';
      card.querySelector('[data-fx]').textContent=`1 USD = — ${c.currency.code}`;

      return card;
    }

    const grid = document.getElementById('grid');
    function render(){
      grid.innerHTML = '';
      COUNTRIES.forEach(c=> grid.appendChild(createCard(c)));
    }

    // ===== تفعيل الإنترنت (اختياري) =====
    async function loadOnlineFor(country, card){
      // نحاول جلب الطقس وأسعار الصرف والأخبار فقط عند الطلب
      try{
        const wurl = `https://api.open-meteo.com/v1/forecast?latitude=${country.lat}&longitude=${country.lon}&current_weather=true&daily=sunset&timezone=${encodeURIComponent(country.tz)}`;
        const wr = await fetch(wurl); if(wr.ok){ const data=await wr.json(); const cw=data.current_weather||{}; const temp=cw.temperature; const code=cw.weathercode; const is_day=cw.is_day===1; const sunsetISO=data?.daily?.sunset?.[0]||null; card.querySelector('[data-temp]').textContent = (temp!=null? Math.round(temp):'—')+'°'; card.style.background = gradient(country.theme,!is_day); if(sunsetISO){ const t=new Date(sunsetISO); card.querySelector('[data-sunset]').textContent = `غروب الشمس: ${t.getHours().toString().padStart(2,'0')}:${t.getMinutes().toString().padStart(2,'0')}`; } card.querySelector('.detail').innerHTML = iconSVGByWeather(code||1, !!is_day); }
      }catch{}
      try{
        const r = await fetch(`https://api.exchangerate.host/latest?base=USD&symbols=${country.currency.code}`); if(r.ok){ const data=await r.json(); const rate=data?.rates?.[country.currency.code]; if(rate){ card.querySelector('[data-fx]').textContent = `1 USD = ${rate.toLocaleString('ar-EG',{maximumFractionDigits:4})} ${country.currency.code}`; } }
      }catch{}
      try{
        const cc = country.code || 'US';
        const rss = `https://news.google.com/rss?hl=ar&gl=${cc}&ceid=${cc}:ar`;
        const resp = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(rss)}`);
        if(resp.ok){ const xml=await resp.text(); const doc=new DOMParser().parseFromString(xml,'text/xml'); const titles=[...doc.querySelectorAll('item>title')].slice(0,8).map(n=>n.textContent.trim()); if(titles.length){ const text=titles.join(' • '); card.querySelector('[data-news]').textContent='  '+text+'   '; card.querySelector('[data-news-dup]').textContent='  '+text+'   '; } }
      }catch{}
    }

    // ===== بحث =====
    document.getElementById('q').addEventListener('input', (e)=>{
      const q = e.target.value.trim().toLowerCase();
      [...grid.children].forEach(card=>{
        const name = (card.dataset.countryName||'').toLowerCase();
        card.style.display = name.includes(q) ? '' : 'none';
      });
    });

    document.getElementById('toggle-online').addEventListener('click',()=>{
      ENABLE_ONLINE = !ENABLE_ONLINE;
      document.getElementById('toggle-online').textContent = ENABLE_ONLINE? 'إيقاف المزايا أونلاين' : 'تشغيل المزايا أونلاين';
      document.getElementById('hint').textContent = ENABLE_ONLINE? 'وضع أونلاين: عند فتح أي بطاقة سيتم جلب الطقس/الأسعار/الأخبار لها.' : 'وضع أوفلاين: لا يوجد أي اتصالات خارجية.';
    });

    // ===== أخطاء عامة تظهر كتنبيه مبسّط =====
    window.addEventListener('error', (e)=>{ console.error(e.error||e.message); });
    window.addEventListener('unhandledrejection', (e)=>{ console.error(e.reason); });

    // بدء
    render();
  </script></body>
</html>
