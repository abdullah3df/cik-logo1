<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>مولّد SpriteSheet — فرخة كرتونية 4 إطارات</title>
<style>
  :root{--bg:#0e1013;--panel:#151922;--text:#e8eef7;--accent:#ffd166}
  *{box-sizing:border-box} html,body{height:100%;margin:0;background:linear-gradient(#1a1f2a,#0e1013);font-family:system-ui,Segoe UI,Roboto,Arial;color:var(--text)}
  .wrap{max-width:980px;margin:auto;padding:20px;display:grid;gap:16px}
  .card{background:var(--panel);border:1px solid #ffffff22;border-radius:16px;padding:16px;box-shadow:0 10px 30px #0006}
  h1{margin:.2em 0 .4em;font-size:1.6rem}
  .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  label{opacity:.9}
  input[type="number"],input[type="color"],select{background:#0c0f15;color:#fff;border:1px solid #ffffff22;border-radius:10px;padding:6px 10px}
  button{background:var(--accent);color:#2b2b2b;font-weight:900;border:none;border-radius:12px;padding:10px 14px;cursor:pointer}
  canvas{background:#0000;max-width:100%}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .mono{font-family:ui-monospace,Consolas,monospace}
  .hint{opacity:.7;font-size:.92rem}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>مولّد SpriteSheet — فرخة كرتونية (4 إطارات)</h1>
    <p class="hint">الإطارات: <b>وقوف</b>، <b>ركض1</b>، <b>ركض2</b>، <b>قفزة</b>. الأسلوب مستوحى من الصورة المرجعية: كتكوت أصفر، منقار برتقالي، عيون كبيرة وخط خارجي داكن.</p>
    <div class="row">
      <label>حجم الإطار (px): <input id="size" type="number" min="32" max="256" value="64"></label>
      <label>سُمك الحد: <input id="stroke" type="number" min="1" max="6" value="3"></label>
      <label>لون الجسم: <input id="cBody" type="color" value="#ffd23f"></label>
      <label>لون الظلال: <input id="cShade" type="color" value="#f3b41b"></label>
      <label>لون المنقار/الأرجل: <input id="cBeak" type="color" value="#ff8f1f"></label>
      <label>لون الحد الخارجي: <input id="cOutline" type="color" value="#6a3f1f"></label>
      <label>خلفية شفافة؟ 
        <select id="bgMode">
          <option value="transparent" selected>نعم (PNG)</option>
          <option value="preview">لا (مع أرضية فاتحة للمعاينة)</option>
        </select>
      </label>
      <button id="rebuild">إعادة توليد</button>
      <button id="download">تحميل PNG</button>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h3>🎞️ SpriteSheet الناتج (4×1)</h3>
      <canvas id="sheet" width="256" height="64" aria-label="SpriteSheet"></canvas>
      <div class="hint mono" id="meta"></div>
    </div>
    <div class="card">
      <h3>▶️ معاينة الحركة</h3>
      <canvas id="preview" width="256" height="160" aria-label="Preview"></canvas>
      <div class="hint">تلميح: عدّل المقاس/الألوان واضغط <b>إعادة توليد</b>، ثم <b>تحميل PNG</b> لاستخدامه في اللعبة (عدد الإطارات = 4).</div>
    </div>
  </div>
</div>

<script>
(() => {
  const sheet = document.getElementById('sheet');
  const prev = document.getElementById('preview');
  const sctx = sheet.getContext('2d');
  const pctx = prev.getContext('2d');
  const ui = {
    size: document.getElementById('size'),
    stroke: document.getElementById('stroke'),
    cBody: document.getElementById('cBody'),
    cShade: document.getElementById('cShade'),
    cBeak: document.getElementById('cBeak'),
    cOutline: document.getElementById('cOutline'),
    bgMode: document.getElementById('bgMode'),
    rebuild: document.getElementById('rebuild'),
    download: document.getElementById('download'),
    meta: document.getElementById('meta')
  };

  function drawChick(ctx, cx, cy, scale, pose, colors, strokeW){
    // pose: 0=stand,1=runA,2=runB,3=jump
    ctx.save();
    ctx.translate(cx, cy);
    ctx.scale(scale, scale);
    ctx.lineJoin='round'; ctx.lineCap='round'; ctx.strokeStyle=colors.out; ctx.fillStyle=colors.body; ctx.lineWidth=strokeW/scale;

    // slight squat/tilt per pose
    const tilt = pose===1 ? -0.06 : pose===2 ? 0.06 : 0;
    ctx.rotate(tilt);
    const bobY = pose===3 ? -2 : (pose===1?1:pose===2? -1:0);
    ctx.translate(0, bobY);

    // body (big circle/oval)
    pathOval(ctx, 0, 6, 22, 18); ctx.fill(); ctx.stroke();

    // belly shade
    ctx.fillStyle = colors.shade; ctx.globalAlpha = .35;
    pathOval(ctx, 4, 10, 14, 10); ctx.fill(); ctx.globalAlpha=1;

    // head
    ctx.fillStyle = colors.body;
    pathOval(ctx, -6, -12, 16, 16); ctx.fill(); ctx.stroke();

    // head feather tuft
    ctx.beginPath();
    ctx.moveTo(-10, -22); ctx.quadraticCurveTo(-8,-26,-5,-22);
    ctx.quadraticCurveTo(-9,-24,-12,-20);
    ctx.stroke();

    // eye
    ctx.fillStyle = '#202020';
    ctx.beginPath(); ctx.arc(-10, -14, 2.8, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = '#ffffff';
    ctx.beginPath(); ctx.arc(-10.8, -14.8, 1.1, 0, Math.PI*2); ctx.fill();

    // beak
    ctx.fillStyle = colors.beak; ctx.strokeStyle=colors.out;
    ctx.beginPath();
    ctx.moveTo(-2,-12);
    ctx.lineTo(6,-10);
    ctx.quadraticCurveTo(-1,-8,-2,-12);
    ctx.closePath(); ctx.fill(); ctx.stroke();

    // wings (animated)
    ctx.fillStyle = colors.body; ctx.strokeStyle=colors.out;
    const wingUp = pose===3 || pose===2;
    ctx.save();
    ctx.translate(8, -2);
    ctx.rotate(wingUp ? -0.6 : -0.15);
    pathOval(ctx, 0, 0, 10, 7); ctx.fill(); ctx.stroke();
    ctx.restore();

    // tail
    ctx.save();
    ctx.translate(16, 6);
    ctx.rotate(0.3);
    pathOval(ctx, 0, 0, 8, 6); ctx.fill(); ctx.stroke();
    ctx.restore();

    // legs (animated)
    ctx.strokeStyle = colors.beak;
    const step = (pose===1), step2=(pose===2);
    // rear leg
    ctx.beginPath();
    ctx.moveTo(-2, 20);
    ctx.lineTo(-2, step?16:20);
    ctx.lineTo(-8, step?22:22);
    ctx.stroke();
    // front leg
    ctx.beginPath();
    ctx.moveTo(6, 20);
    ctx.lineTo(6, step2?16:20);
    ctx.lineTo(12, step2?22:22);
    ctx.stroke();

    // outline polish around beak-bottom
    ctx.strokeStyle = colors.out;
    ctx.beginPath();
    ctx.moveTo(-2,-11.5); ctx.quadraticCurveTo(-1,-9.5,1,-9.2); ctx.stroke();

    ctx.restore();
  }

  function pathOval(ctx, x, y, rx, ry){
    ctx.beginPath();
    ctx.ellipse(x, y, rx, ry, 0, 0, Math.PI*2);
  }

  function rebuild(){
    const size = +ui.size.value || 64;
    const stroke = +ui.stroke.value || 3;
    const cols = {
      body: ui.cBody.value,
      shade: ui.cShade.value,
      beak: ui.cBeak.value,
      out : ui.cOutline.value
    };

    // resize sheet (4 frames horizontally)
    sheet.width = size * 4;
    sheet.height = size;

    // optional preview background
    if (ui.bgMode.value==='preview'){
      sctx.fillStyle = '#fff8e6';
      sctx.fillRect(0,0,sheet.width,sheet.height);
    }else{
      sctx.clearRect(0,0,sheet.width,sheet.height);
    }

    // draw frames
    const poses = [0,1,2,3];
    for (let i=0;i<4;i++){
      const x = i*size, y = 0;
      // frame box (transparent)
      // draw chick centered
      sctx.save();
      sctx.translate(x + size/2, size/2);
      const scale = size/64; // designed around ~64px
      drawChick(sctx, 0, 0, scale, poses[i], cols, stroke);
      sctx.restore();
    }

    ui.meta.textContent = `المقاس: ${size}×${size} لكل إطار — إجمالي: ${sheet.width}×${sheet.height} — إطارات: 4 — تنسيق: PNG شفاف`;
    buildPreview();
  }

  // simple running preview
  let t0=0, frame=0, acc=0;
  function buildPreview(){
    t0 = performance.now(); frame=0; acc=0;
  }
  function loop(ts){
    const dt = ((ts - t0)/1000)||0; t0 = ts;
    acc += dt;
    const fps = 8; // preview FPS
    if (acc >= 1/fps){ acc = 0; frame = (frame+1)%4; }
    // draw
    pctx.clearRect(0,0,prev.width,prev.height);
    // ground
    pctx.fillStyle = '#a1e6a1'; pctx.fillRect(0,120,prev.width,40);
    // chick from sheet
    const size = +ui.size.value || 64;
    const sx = frame*size, sy = 0;
    // shadow
    pctx.fillStyle = 'rgba(0,0,0,.2)'; pctx.beginPath(); pctx.ellipse(128,118,28,6,0,0,Math.PI*2); pctx.fill();
    pctx.drawImage(sheet, sx, sy, size, size, 128-size/2, 118-size, size, size);

    requestAnimationFrame(loop);
  }

  function downloadPNG(){
    // force PNG with transparency preserved
    const url = sheet.toDataURL('image/png');
    const a = document.createElement('a');
    a.href = url;
    a.download = `chicken_run_${+ui.size.value||64}px_x4.png`;
    a.click();
  }

  ui.rebuild.addEventListener('click', rebuild);
  ui.download.addEventListener('click', downloadPNG);

  // initial build + start preview loop
  rebuild();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
